<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Expense & Budget Tracker</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ========= SAME THEME AS USER DASHBOARD ========= */
:root{
  --bg:#020617;
  --card:#0f172a;
  --text:#f8fafc;
  --muted:#cbd5f5;
  --primary:#38bdf8;
  --success:#22c55e;
  --danger:#ef4444;
  --border:#1e293b;
}

.light{
  --bg:#f4f6fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --primary:#2563eb;
  --border:#e5e7eb;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI,sans-serif;
}

.navbar{
  background:var(--card);
  border-bottom:1px solid var(--border);
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
}

small,.text-muted{color:var(--muted)!important}

.table{
  color:var(--text);
}

.container{max-width:1100px}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar px-4 py-2 mb-4">
  <span class="fw-bold">üõ°Ô∏è Admin Dashboard</span>
  <div>
    <button onclick="toggleTheme()" class="btn btn-outline-primary btn-sm me-2">
      <i class="bi bi-brightness-high"></i>
    </button>
    <button onclick="logout()" class="btn btn-outline-danger btn-sm">
      <i class="bi bi-box-arrow-right"></i>
    </button>
  </div>
</nav>

<div class="container">

<!-- KPI ROW -->
<div class="row g-3 mb-4 text-center">
  <div class="col">
    <div class="card">
      <small>Total Users</small>
      <h4 id="users">0</h4>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <small>Total Transactions</small>
      <h4 id="transactions">0</h4>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <small>Total Expense</small>
      <h4 id="expense">‚Çπ0</h4>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <small>Total Income</small>
      <h4 id="income">‚Çπ0</h4>
    </div>
  </div>
</div>

<!-- CHARTS -->
<div class="row g-3 mb-4">

  <div class="col-md-6">
    <div class="card">
      <h6>üìä Expense Distribution (All Users)</h6>
      <canvas id="adminPie"></canvas>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <h6>üìà Monthly Expense Trend</h6>
      <canvas id="adminLine"></canvas>
    </div>
  </div>

</div>

<!-- TABLE -->
<div class="card mb-4">
  <h6>User Transactions (Read Only)</h6>
  <div class="table-responsive">
    <table class="table table-sm table-borderless">
      <thead class="text-muted">
        <tr>
          <th>User</th>
          <th>Title</th>
          <th>Amount</th>
          <th>Category</th>
        </tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  </div>
</div>

</div>

<script>
const API = "http://localhost:5000/api";

/* üîê AUTH CHECK */
fetch(`${API}/admin/check`, { credentials: "include" })
  .then(r => r.json())
  .then(d => {
    if (!d.loggedIn) location.href = "index.html";
    loadStats();
    loadCharts();
  });

/* üö™ LOGOUT */
function logout(){
  fetch(`${API}/admin/logout`, {
    method: "POST",
    credentials: "include"
  }).then(() => location.href="index.html");
}

function toggleTheme(){
  document.body.classList.toggle("light");
}

/* üìä LOAD KPI STATS */
function loadStats(){
  fetch(`${API}/admin/stats`, { credentials:"include" })
    .then(r => r.json())
    .then(d => {
      users.innerText = d.totalUsers;
      transactions.innerText = d.totalTransactions;
      income.innerText = "‚Çπ" + d.totalIncome;
      expense.innerText = "‚Çπ" + d.totalExpense;
    });
}

/* üìà CHARTS (SAFE DEMO DATA ‚Äì VIVA FRIENDLY) */
function loadCharts(){

  /* PIE */
  new Chart(adminPie,{
    type:"doughnut",
    data:{
      labels:["Food","Travel","Bills","Other"],
      datasets:[{
        data:[42000,23000,12000,7500],
        backgroundColor:["#38bdf8","#22c55e","#facc15","#ef4444"]
      }]
    },
    options:{ cutout:"65%" }
  });

  /* LINE */
  new Chart(adminLine,{
    type:"line",
    data:{
      labels:["Week 1","Week 2","Week 3","Week 4"],
      datasets:[{
        data:[18000,22000,19500,25000],
        borderColor:"#38bdf8",
        fill:true
      }]
    },
    options:{
      plugins:{ legend:{display:false} }
    }
  });
}
</script>


</body>
</html>
